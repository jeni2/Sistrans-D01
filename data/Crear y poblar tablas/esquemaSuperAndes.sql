create sequence superAndes_sequence;

--Creación Tabla CATEGORIA y restricciónes
CREATE TABLE CATEGORIA
    (NOMBRE VARCHAR2(100 BYTE),
     CONSTRAINT CATEGORIA_PK PRIMARY KEY (NOMBRE)
    );

--Creación Tabla TIPO
CREATE TABLE TIPO
    (NOMBRE VARCHAR2(100 BYTE),
     CATEGORIA VARCHAR2(100 BYTE) NOT NULL,
     CONSTRAINT TIPO_PK PRIMARY KEY (NOMBRE)
    );
ALTER TABLE TIPO
    ADD CONSTRAINT fk_categoria_tipo
    FOREIGN KEY (CATEGORIA) REFERENCES CATEGORIA(NOMBRE)
    ON DELETE CASCADE
    ENABLE;

--Creación Tabla PROVEEDOR y restricciónes
CREATE TABLE PROVEEDOR
    (NIT VARCHAR2(100 BYTE),
    NOMBRE VARCHAR2(100) NOT NULL,
    CALIFICACIONCALIDAD NUMBER(1,2) NOT NULL,
    CONSTRAINT PROVEEDOR_PK PRIMARY KEY(NIT)
    );
ALTER TABLE PROVEEDOR
    ADD CONSTRAINT nombre_unico
    UNIQUE (NOMBRE)
    ENABLE;
ALTER TABLE PROVEEDOR
    ADD CONSTRAINT calificacion_valida
    CHECK (CALIFICACIONCALIDAD BETWEEN 0 AND 5)
    ENABLE;
 
--Creación Tabla PROMOCION y restricciónes
CREATE TABLE PROMOCION
    (ID NUMBER,
    DESCRIPCION VARCHAR2(250 BYTE),
    PRECIO NUMBER NOT NULL,
    INICIO DATE NOT NULL,
    FIN DATE NOT NULL,
    UNIDADESDISPONIBLES NUMBER(*) NOT NULL,
    UNIDADESVENDIDAS NUMBER(*) NOT NULL,
    PROVEEDOR VARCHAR2(100 BYTE),    
    CONSTRAINT PROMOCION_PK PRIMARY KEY (ID)
    );
ALTER TABLE PROMOCION
    ADD CONSTRAINT fk_proveedor_prom
    FOREIGN KEY (PROVEEDOR) REFERENCES PROVEEDOR(NIT)
    ENABLE;

--Creación Tabla PRODUCTO y restricciónes
CREATE TABLE PRODUCTO
    (CODIGOBARRAS VARCHAR2(13 BYTE) ,
     NOMBRE VARCHAR2(100 BYTE) NOT NULL,
     MARCA VARCHAR2(100 BYTE) NOT NULL,
     PRECIOUNITARIO NUMBER NOT NULL,
     PRESENTACION VARCHAR2(255 BYTE) NOT NULL ,
     PRECIOUNIDADMEDIDA NUMBER NOT NULL,
     CANTIDADPRESENTACION NUMBER NOT NULL,
     PESO NUMBER NOT NULL,
     UNIDADMEDIDAPESO VARCHAR2(10 BYTE) NOT NULL,
     VOLUMEN NUMBER NOT NULL,
     UNIDADMEDIDAVOLUMEN VARCHAR2(10 BYTE) NOT NULL,
     CALIDAD NUMBER NOT NULL,
     NIVELREORDEN NUMBER NOT NULL,
     FECHAVENCIMIENTO DATE, 
     CATEGORIA VARCHAR2(100 BYTE) NOT NULL,
     PROMOCION NUMBER,
     CONSTRAINT PRODUCTO_PK PRIMARY KEY(CODIGOBARRAS)
    );
ALTER TABLE PRODUCTO
    ADD CONSTRAINT CK_CodBarras
    CHECK (LENGTH(CODIGOBARRAS) = 13)
    ENABLE;
ALTER TABLE PRODUCTO
    ADD CONSTRAINT fk_categoria_producto
    FOREIGN KEY (CATEGORIA) REFERENCES CATEGORIA(NOMBRE)
    ENABLE;
ALTER TABLE PRODUCTO
    ADD CONSTRAINT fk_promocion
    FOREIGN KEY (PROMOCION) REFERENCES PROMOCION(ID)
    ENABLE;

--Creación Tabla PERSONANATURAL y restricciónes
CREATE TABLE PERSONANATURAL
    (DOCUMENTO VARCHAR2(100 BYTE),
    TIPODOCUMENTO VARCHAR2(100 BYTE),
    CONSTRAINT PERSONANATURAL_PK PRIMARY KEY (DOCUMENTO, TIPODOCUMENTO)
    );

--Creación Tabla EMPRESA y restricciónes
CREATE TABLE EMPRESA
    (NIT VARCHAR2(100 BYTE),
    DIRECCION VARCHAR2(255 BYTE) NOT NULL,
    CONSTRAINT EMPRESA_PK PRIMARY KEY(NIT)
    );
ALTER TABLE EMPRESA
    ADD CONSTRAINT direccion_unica
    UNIQUE (DIRECCION)
    ENABLE;

--Creación Tabla CLIENTE y restricciónes
CREATE TABLE CLIENTE
    (CORREOELECTRONICO VARCHAR2(255 BYTE),
    NOMBRE VARCHAR2(200 BYTE) NOT NULL,
    PUNTOS NUMBER(*) NOT NULL,
    EMPRESA VARCHAR2(100 BYTE),
    DOCUMENTOPN VARCHAR2(100 BYTE),
    TIPODOCPN VARCHAR2(100 BYTE),
    CONSTRAINT CLIENTE_PK PRIMARY KEY (CORREOELECTRONICO)
    );
ALTER TABLE CLIENTE
    ADD CONSTRAINT doc_unico
    UNIQUE (DOCUMENTOPN)
    ENABLE;
ALTER TABLE CLIENTE
    ADD CONSTRAINT fk_personaNatural
    FOREIGN KEY (DOCUMENTOPN, TIPODOCPN) REFERENCES PERSONANATURAL(DOCUMENTO, TIPODOCUMENTO)
    ON DELETE CASCADE
    ENABLE;
ALTER TABLE CLIENTE
    ADD CONSTRAINT empresa_unica
    UNIQUE (EMPRESA)
    ENABLE;
ALTER TABLE CLIENTE
    ADD CONSTRAINT fk_empresa
    FOREIGN KEY (EMPRESA) REFERENCES EMPRESA(NIT)
    ON DELETE CASCADE
    ENABLE;

--Creación Tabla FACTURA y restricciónes
CREATE TABLE FACTURA
    (NUMERO NUMBER,
    DIRECCION VARCHAR2(255 BYTE) NOT NULL,
    FECHA DATE NOT NULL,
    NOMBRECAJERO VARCHAR2(200 BYTE) NOT NULL,
    VALORTOTAL NUMBER NOT NULL,
    PAGOEXITOSO NUMBER(1) NOT NULL,
    PUNTOSCOMPRA NUMBER(*) NOT NULL,
    CLIENTE VARCHAR2(255 BYTE),
    CONSTRAINT FACTURA_PK PRIMARY KEY (NUMERO)
    );
ALTER TABLE FACTURA
    ADD CONSTRAINT rango_exito
    CHECK (PAGOEXITOSO BETWEEN 0 AND 1)
    ENABLE;
ALTER TABLE FACTURA
    ADD CONSTRAINT fk_cliente
    FOREIGN KEY (CLIENTE) REFERENCES CLIENTE(CORREOELECTRONICO)
    ENABLE;

--Creación Tabla SUCURSAL y restricciónes
CREATE TABLE SUCURSAL
    (DIRECCION VARCHAR2(255 BYTE),
    CIUDAD VARCHAR2(150 BYTE),
    NOMBRE VARCHAR2(200 BYTE) NOT NULL,
    SEGMENTACIONMERCADO VARCHAR2(200) NOT NULL,
    TAMANIO NUMBER NOT NULL,
    CONSTRAINT SUCURSAL_PK PRIMARY KEY (DIRECCION, CIUDAD)
    );
ALTER TABLE SUCURSAL
    ADD CONSTRAINT nombreSuc_unico
    UNIQUE(NOMBRE)
    ENABLE;

--Creación Tabla ORDENPEDIDO y restricciónes
CREATE TABLE ORDENPEDIDO
    (ID NUMBER,
    FECHAENTREGA DATE,
    FECHAESPERADAENTREGA DATE NOT NULL,
    CALIFICACIONPROVEEDOR NUMBER(1,2) NOT NULL,
    PROVEEDOR VARCHAR2(100 BYTE) NOT NULL,
    DIRECCIONSUCURSAL VARCHAR2(255 BYTE) NOT NULL,
    CIUDADSUCURSAL VARCHAR2(255 BYTE) NOT NULL,
    CONSTRAINT ORDENPEDIDO_PK PRIMARY KEY (ID)
    );
ALTER TABLE ORDENPEDIDO
    ADD CONSTRAINT calificacion_orden_valida
    CHECK (CALIFICACIONPROVEEDOR BETWEEN 0 AND 5)
    ENABLE;
ALTER TABLE ORDENPEDIDO
    ADD CONSTRAINT fk_sucursal_orden
    FOREIGN KEY (DIRECCIONSUCURSAL, CIUDADSUCURSAL) REFERENCES SUCURSAL(DIRECCION, CIUDAD)
    ENABLE;
ALTER TABLE ORDENPEDIDO
    ADD CONSTRAINT fk_proveedor
    FOREIGN KEY (PROVEEDOR) REFERENCES PROVEEDOR(NIT)
    ENABLE;
       
--Creación Tabla BODEGA y restricciónes
CREATE TABLE BODEGA
    (ID NUMBER,
    CAPACIDADVOL NUMBER NOT NULL,
    CAPACIDADPESO NUMBER NOT NULL,
    TIPO VARCHAR2(100 BYTE) NOT NULL,
    DIRECCIONSUCURSAL VARCHAR2(255 BYTE) NOT NULL,
    CIUDADSUCURSAL VARCHAR2(255 BYTE) NOT NULL,
    CONSTRAINT BODEGA_PK PRIMARY KEY (ID)
    );
ALTER TABLE BODEGA
    ADD CONSTRAINT fk_sucursal_bodega
    FOREIGN KEY (DIRECCIONSUCURSAL, CIUDADSUCURSAL) REFERENCES SUCURSAL(DIRECCION, CIUDAD)
    ON DELETE CASCADE
    ENABLE;
ALTER TABLE BODEGA
    ADD CONSTRAINT fk_categoria_bodega
    FOREIGN KEY (TIPO) REFERENCES CATEGORIA(NOMBRE)
    ENABLE;

--Creación Tabla ESTANTE y restricciónes
CREATE TABLE ESTANTE
    (ID NUMBER,
    CAPACIDADVOL NUMBER NOT NULL,
    CAPACIDADPESO NUMBER NOT NULL,
    TIPO VARCHAR2(100 BYTE) NOT NULL,
    DIRECCIONSUCURSAL VARCHAR2(255 BYTE) NOT NULL,
    CIUDADSUCURSAL VARCHAR2(255 BYTE) NOT NULL,
    CONSTRAINT ESTANTE_PK PRIMARY KEY (ID)
    );
ALTER TABLE ESTANTE
    ADD CONSTRAINT fk_sucursal_estante
    FOREIGN KEY (DIRECCIONSUCURSAL, CIUDADSUCURSAL) REFERENCES SUCURSAL(DIRECCION, CIUDAD)
    ON DELETE CASCADE
    ENABLE;
ALTER TABLE ESTANTE
    ADD CONSTRAINT fk_categoria_estante
    FOREIGN KEY (TIPO) REFERENCES CATEGORIA(NOMBRE)
    ENABLE;

--INICIO CREACION DE TABLAS DE RELACIONES MUCHOS A MUCHOS.

--Creación Tabla PROVEEDORES_PRODUCTO y restricciónes
CREATE TABLE PROVEEDORES_PRODUCTO
    (PROVEEDOR VARCHAR2(100 BYTE),
    PRODUCTO VARCHAR2(13 BYTE),
    CONSTRAINT PROVEEDORES_PRODUCTO_PK PRIMARY KEY (PROVEEDOR, PRODUCTO)
    );
ALTER TABLE PROVEEDORES_PRODUCTO
    ADD CONSTRAINT fk_proveedor_producto
    FOREIGN KEY (PROVEEDOR) REFERENCES PROVEEDOR(NIT)
    ENABLE;
ALTER TABLE PROVEEDORES_PRODUCTO
    ADD CONSTRAINT fk_producto_proveedor
    FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTO(CODIGOBARRAS)
    ENABLE;

--Creación Tabla PRODUCTO_ORDENPEDIDO y restricciónes
    CREATE TABLE PRODUCTO_ORDENPEDIDO
    (PEDIDO NUMBER,
    CANTIDAD NUMBER(*) NOT NULL,
    CALIDAD NUMBER(1,2) NOT NULL,
    PRODUCTO VARCHAR2(13 BYTE),
    CONSTRAINT PRODUCTO_ORDENPEDIDO_PK PRIMARY KEY (PEDIDO, PRODUCTO)
    );
ALTER TABLE PRODUCTO_ORDENPEDIDO
    ADD CONSTRAINT fk_pedido
    FOREIGN KEY (PEDIDO) REFERENCES ORDENPEDIDO(ID)
    ENABLE;
ALTER TABLE PRODUCTO_ORDENPEDIDO
    ADD CONSTRAINT fk_producto_orden
    FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTO(CODIGOBARRAS)
    ENABLE;

--Creación Tabla FACTURA_PRODUCTO y restricciónes
CREATE TABLE FACTURA_PRODUCTO
    (FACTURA NUMBER,
    CANTIDAD NUMBER(*) NOT NULL,
    PRODUCTO VARCHAR2(13 BYTE),
    CONSTRAINT FACTURA_PRODUCTO_PK PRIMARY KEY (FACTURA, PRODUCTO)
    );
ALTER TABLE FACTURA_PRODUCTO
    ADD CONSTRAINT fk_factura_producto
    FOREIGN KEY (FACTURA) REFERENCES FACTURA(NUMERO)
    ENABLE;
ALTER TABLE FACTURA_PRODUCTO
    ADD CONSTRAINT fk_producto_factura
    FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTO(CODIGOBARRAS)
    ENABLE;
    
--Creación Tabla CLIENTE_SUCURSAL y restricciónes
CREATE TABLE CLIENTE_SUCURSAL
    (CLIENTE VARCHAR2(255 BYTE),
    DIRECCIONSUCURSAL VARCHAR2(255 BYTE),
    CIUDADSUCURSAL VARCHAR2(255 BYTE),
    CONSTRAINT CLIENTE_SUCURSAL_PK PRIMARY KEY (CLIENTE, DIRECCIONSUCURSAL, CIUDADSUCURSAL)
    );
ALTER TABLE CLIENTE_SUCURSAL
    ADD CONSTRAINT fk_cliente_sucursal
    FOREIGN KEY (CLIENTE) REFERENCES CLIENTE(CORREOELECTRONICO)
    ON DELETE CASCADE
    ENABLE;
ALTER TABLE CLIENTE_SUCURSAL
    ADD CONSTRAINT fk_sucursal_cliente
    FOREIGN KEY (DIRECCIONSUCURSAL, CIUDADSUCURSAL) REFERENCES SUCURSAL(DIRECCION, CIUDAD)
    ON DELETE CASCADE
    ENABLE;
    
--Creación Tabla PRODUCTOSENBODEGA y restricciónes
CREATE TABLE PRODUCTOSENBODEGA
    (BODEGA NUMBER,
    CANTIDAD NUMBER(*) NOT NULL,
    NIVELABASTECIMIENTO NUMBER(*) NOT NULL,
    PRODUCTO VARCHAR2(13 BYTE),
    CONSTRAINT PRODUCTOSENBODEGA_PK PRIMARY KEY (BODEGA, PRODUCTO)
    );
ALTER TABLE PRODUCTOSENBODEGA
    ADD CONSTRAINT fk_bodega
    FOREIGN KEY (BODEGA) REFERENCES BODEGA(ID)
    ON DELETE CASCADE
    ENABLE;
ALTER TABLE PRODUCTOSENBODEGA
    ADD CONSTRAINT fk_producto_bodega
    FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTO(CODIGOBARRAS)
    ENABLE;
    
--Creación Tabla PRODUCTOSENESTANTE y restricciónes
CREATE TABLE PRODUCTOSENESTANTE
    (ESTANTE NUMBER,
    CANTIDAD NUMBER(*) NOT NULL,
    PRODUCTO VARCHAR2(13 BYTE),
    CONSTRAINT PRODUCTOSENESTANTE_PK PRIMARY KEY (ESTANTE, PRODUCTO)
    );
ALTER TABLE PRODUCTOSENESTANTE
    ADD CONSTRAINT fk_estante
    FOREIGN KEY (ESTANTE) REFERENCES ESTANTE(ID)
    ON DELETE CASCADE
    ENABLE;
ALTER TABLE PRODUCTOSENESTANTE
    ADD CONSTRAINT fk_producto_estante 
    FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTO(CODIGOBARRAS)
    ENABLE;

--Creación Tabla SUCURSAL_PRODUCTO y restricciónes
CREATE TABLE SUCURSAL_PRODUCTO
    (DIRECCIONSUCURSAL VARCHAR2(255 BYTE),
    CIUDADSUCURSAL VARCHAR2(255 BYTE),
    PRODUCTO VARCHAR2(13 BYTE),
    CONSTRAINT SUCURSAL_PRODUCTO_PK PRIMARY KEY (PRODUCTO, DIRECCIONSUCURSAL, CIUDADSUCURSAL)
    );
ALTER TABLE SUCURSAL_PRODUCTO
    ADD CONSTRAINT fk_sucursal_producto
    FOREIGN KEY (DIRECCIONSUCURSAL, CIUDADSUCURSAL) REFERENCES SUCURSAL(DIRECCION, CIUDAD)
    ON DELETE CASCADE
    ENABLE;
ALTER TABLE SUCURSAL_PRODUCTO
    ADD CONSTRAINT fk_producto_sucursal
    FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTO(CODIGOBARRAS)
    ON DELETE CASCADE
    ENABLE;
    
--Creación tabla HISTORIAL_PROMOCIONES
CREATE TABLE HISTORIAL_PROMOCIONES
    (PRODUCTO VARCHAR2(13 BYTE),
    PROMOCION NUMBER,
    CONSTRAINT HISTORIAL_PROMOCIONES_PK PRIMARY KEY (PRODUCTO, PROMOCION)
    );
ALTER TABLE HISTORIAL_PROMOCIONES
    ADD CONSTRAINT fk_producto_promocion
    FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTO(CODIGOBARRAS)
    ENABLE;
ALTER TABLE HISTORIAL_PROMOCIONES  
    ADD CONSTRAINT fk_promocion_producto
    FOREIGN KEY (PROMOCION) REFERENCES PROMOCION(ID)
    ENABLE;

--FIN DE CREACIÓN DE LAS 21 TABLAS, COMMIT
COMMIT; 